!function(e){"use strict";var o={inputApiKeyId:"woocommerce_woogosend_gmaps_api_key",inputLatId:"woocommerce_woogosend_origin_lat",inputLngId:"woocommerce_woogosend_origin_lng",mapWrapperId:"woogosend-map-wrapper",mapSearchId:"woogosend-map-search",mapCanvasId:"woogosend-map-canvas",zoomLevel:16,init:function(){var o=this;woogosend_params.show_settings&&setTimeout(function(){for(var o=!1,a=e(document).find(".wc-shipping-zone-method-type"),n=0;n<a.length;n++){var t=a[n];if(e(t).text()==woogosend_params.method_title)return e(t).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(o=!0)}o||(e(".wc-shipping-zone-add-method").trigger("click"),e("select[name='add_method_id']").val(woogosend_params.method_id).trigger("change"))},200),e(document).on("click",".wc-shipping-zone-method-settings",function(){e(this).closest("tr").find(".wc-shipping-zone-method-type").text()===woogosend_params.method_title&&(e("#"+o.mapCanvasId).remove(),e("#"+o.mapSearchId).remove(),e("#"+o.inputApiKeyId).trigger("change"))}),e(document).on("change","#"+o.inputApiKeyId,function(){o._loadScript(e(this).val())})},_loadScript:function(o){var a=this;"undefined"!=typeof google&&void 0!==google.maps&&(window.google.maps={});try{var n="https://maps.googleapis.com/maps/api/js?key="+o+"&libraries=geometry,places";e.getScript(n,function(){a._buildMap()})}catch(e){console.log("error_buildMap",e)}},_buildMap:function(){var o=this,a=e("#"+o.inputLatId).val(),n=e("#"+o.inputLngId).val(),t={lat:a=a.length?parseFloat(a):-6.175392,lng:n=n.length?parseFloat(n):106.827153},s=wp.template(o.mapCanvasId),d=wp.template(o.mapSearchId);e("#"+o.mapCanvasId).length||e("#"+o.mapWrapperId).append(s({map_canvas_id:o.mapCanvasId}));var i=[],p=new google.maps.Map(document.getElementById(o.mapCanvasId),{center:t,zoom:o.zoomLevel,mapTypeId:"roadmap"}),r=new google.maps.Marker({map:p,position:t,draggable:!0,icon:woogosend_params.marker}),g=new google.maps.InfoWindow({maxWidth:350,content:woogosend_params.txt.drag_marker});g.open(p,r),google.maps.event.addListener(r,"dragstart",function(e){g.close()}),google.maps.event.addListener(r,"dragend",function(e){o._setLatLng(e.latLng,r,p,g)}),i.push(r),e("#"+o.mapSearchId).length||e("#"+o.mapWrapperId).append(d({map_search_id:o.mapSearchId}));var m=document.getElementById(o.mapSearchId),c=new google.maps.places.SearchBox(m);p.controls[google.maps.ControlPosition.TOP_LEFT].push(m),p.addListener("bounds_changed",function(){c.setBounds(p.getBounds())}),c.addListener("places_changed",function(){var e=c.getPlaces();if(0!=e.length){i.forEach(function(e){e.setMap(null)}),i=[];var a=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?(r=new google.maps.Marker({map:p,position:e.geometry.location,draggable:!0,icon:woogosend_params.marker}),o._setLatLng(e.geometry.location,r,p,g),google.maps.event.addListener(r,"dragstart",function(e){g.close()}),google.maps.event.addListener(r,"dragend",function(e){o._setLatLng(e.latLng,r,p,g)}),i.push(r),e.geometry.viewport?a.union(e.geometry.viewport):a.extend(e.geometry.location)):console.log("Returned place contains no geometry")}),p.setZoom(o.zoomLevel),p.fitBounds(a)}})},_setLatLng:function(o,a,n,t){var s=this;(new google.maps.Geocoder).geocode({latLng:o},function(d,i){i==google.maps.GeocoderStatus.OK&&(d[0]?(t.setContent(d[0].formatted_address),t.open(n,a),e("#"+s.inputLatId).val(o.lat()),e("#"+s.inputLngId).val(o.lng())):(e("#"+s.inputLatId).val(""),e("#"+s.inputLngId).val("")))}),n.setCenter(o)}};e(document).ready(function(){o.init()})}(jQuery);