!function(e){"use strict";var o={_inputLatId:"woocommerce_woogosend_origin_lat",_inputLngId:"woocommerce_woogosend_origin_lng",_mapWrapperId:"woogosend-map-wrapper",_mapSearchId:"woogosend-map-search",_mapCanvasId:"woogosend-map-canvas",_zoomLevel:16,_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",init:function(){var o=this;woogosend_params.show_settings&&setTimeout(function(){for(var o=!1,t=e(document).find(".wc-shipping-zone-method-type"),n=0;n<t.length;n++){var a=t[n];if(e(a).text()==woogosend_params.method_title)return e(a).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(o=!0)}o||(e(".wc-shipping-zone-add-method").trigger("click"),e("select[name='add_method_id']").val(woogosend_params.method_id).trigger("change"))},200),e(document).on("click",".wc-shipping-zone-method-settings",function(){e(this).closest("tr").find(".wc-shipping-zone-method-type").text()===woogosend_params.method_title&&o._initGoogleMaps()})},_initGoogleMaps:function(o){var t=this;e("#"+t._inputLatId).closest("tr").hide(),e("#"+t._inputLngId).closest("tr").hide();try{if("undefined"==typeof google||void 0===google.maps)throw"google is not defined";t._buildGoogleMaps()}catch(o){e.getScript("https://maps.googleapis.com/maps/api/js?key="+t._decode(e("#map-secret-key").val())+"&libraries=geometry,places&&language="+woogosend_params.language,function(){t._buildGoogleMaps()})}},_buildGoogleMaps:function(){var o=this,t=e("#"+o._inputLatId).val(),n=e("#"+o._inputLngId).val(),a={lat:t=t.length?parseFloat(t):-6.175392,lng:n=n.length?parseFloat(n):106.827153},r=wp.template(o._mapCanvasId),d=wp.template(o._mapSearchId);e("#"+o._mapCanvasId).length||e("#"+o._mapWrapperId).append(r({map_canvas_id:o._mapCanvasId}));var i=[],s=new google.maps.Map(document.getElementById(o._mapCanvasId),{center:a,zoom:o._zoomLevel,mapTypeId:"roadmap"}),g=new google.maps.Marker({map:s,position:a,draggable:!0,icon:woogosend_params.marker}),c=new google.maps.InfoWindow({maxWidth:350,content:woogosend_params.txt.drag_marker});c.open(s,g),google.maps.event.addListener(g,"dragstart",function(e){c.close()}),google.maps.event.addListener(g,"dragend",function(e){o._setLatLng(e.latLng,g,s,c)}),i.push(g),e("#"+o._mapSearchId).length||e("#"+o._mapWrapperId).append(d({map_search_id:o._mapSearchId}));var p=document.getElementById(o._mapSearchId),m=new google.maps.places.SearchBox(p);s.controls[google.maps.ControlPosition.TOP_LEFT].push(p),s.addListener("bounds_changed",function(){m.setBounds(s.getBounds())}),m.addListener("places_changed",function(){var e=m.getPlaces();if(0!==e.length){i.forEach(function(e){e.setMap(null)}),i=[];var t=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?(g=new google.maps.Marker({map:s,position:e.geometry.location,draggable:!0,icon:woogosend_params.marker}),o._setLatLng(e.geometry.location,g,s,c),google.maps.event.addListener(g,"dragstart",function(e){c.close()}),google.maps.event.addListener(g,"dragend",function(e){o._setLatLng(e.latLng,g,s,c)}),i.push(g),e.geometry.viewport?t.union(e.geometry.viewport):t.extend(e.geometry.location)):console.log("Returned place contains no geometry")}),s.setZoom(o._zoomLevel),s.fitBounds(t)}}),setInterval(function(){e(".gm-err-content").length&&(e("#"+o._mapCanvasId).closest("tr").hide(),e("#"+o._inputLatId).closest("tr").show(),e("#"+o._inputLngId).closest("tr").show(),google=void 0)},1e3)},_setLatLng:function(o,t,n,a){var r=this;(new google.maps.Geocoder).geocode({latLng:o},function(d,i){i==google.maps.GeocoderStatus.OK&&(d[0]?(a.setContent(d[0].formatted_address),a.open(n,t),e("#"+r._inputLatId).val(o.lat()),e("#"+r._inputLngId).val(o.lng())):(e("#"+r._inputLatId).val(""),e("#"+r._inputLngId).val("")))}),n.setCenter(o)},_encode:function(e){var o,t,n,a,r,d,i,s="",g=0;for(e=this._utf8_encode(e);g<e.length;)a=(o=e.charCodeAt(g++))>>2,r=(3&o)<<4|(t=e.charCodeAt(g++))>>4,d=(15&t)<<2|(n=e.charCodeAt(g++))>>6,i=63&n,isNaN(t)?d=i=64:isNaN(n)&&(i=64),s=s+this._keyStr.charAt(a)+this._keyStr.charAt(r)+this._keyStr.charAt(d)+this._keyStr.charAt(i);return s},_decode:function(e){var o,t,n,a,r,d,i="",s=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");s<e.length;)o=this._keyStr.indexOf(e.charAt(s++))<<2|(a=this._keyStr.indexOf(e.charAt(s++)))>>4,t=(15&a)<<4|(r=this._keyStr.indexOf(e.charAt(s++)))>>2,n=(3&r)<<6|(d=this._keyStr.indexOf(e.charAt(s++))),i+=String.fromCharCode(o),64!=r&&(i+=String.fromCharCode(t)),64!=d&&(i+=String.fromCharCode(n));return i=this._utf8_decode(i)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var o="",t=0;t<e.length;t++){var n=e.charCodeAt(t);n<128?o+=String.fromCharCode(n):n>127&&n<2048?(o+=String.fromCharCode(n>>6|192),o+=String.fromCharCode(63&n|128)):(o+=String.fromCharCode(n>>12|224),o+=String.fromCharCode(n>>6&63|128),o+=String.fromCharCode(63&n|128))}return o},_utf8_decode:function(e){for(var o="",t=0,n=0,a=0;t<e.length;)(n=e.charCodeAt(t))<128?(o+=String.fromCharCode(n),t++):n>191&&n<224?(a=e.charCodeAt(t+1),o+=String.fromCharCode((31&n)<<6|63&a),t+=2):(a=e.charCodeAt(t+1),c3=e.charCodeAt(t+2),o+=String.fromCharCode((15&n)<<12|(63&a)<<6|63&c3),t+=3);return o}};e(document).ready(function(){o.init()})}(jQuery);