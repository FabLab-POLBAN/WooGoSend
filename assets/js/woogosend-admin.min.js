!function(e){"use strict";var t={_inputLatSel:"",_inputLngSel:"",_mapWrapperSel:"",_mapSearchSel:"",_mapCanvasSel:"",_serviceToggleSel:"",_zoomLevel:16,_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_params:{},init:function(t){var a=this;a._params=t,a._inputLatSel="woocommerce_"+a._params.method_id+"_origin_lat",a._inputLngSel="woocommerce_"+a._params.method_id+"_origin_lng",a._mapWrapperSel=a._params.method_id+"-map-wrapper",a._mapSearchSel=a._params.method_id+"-map-search",a._mapCanvasSel=a._params.method_id+"-map-canvas",a._serviceToggleSel=a._params.method_id+"-toggle-service",a._params.show_settings&&setTimeout(function(){for(var t=!1,o=e(document).find(".wc-shipping-zone-method-type"),n=0;n<o.length;n++){var r=o[n];if(e(r).text()==a._params.method_title)return e(r).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(t=!0)}t||(e(".wc-shipping-zone-add-method").trigger("click"),e("select[name='add_method_id']").val(a._params.method_id).trigger("change"))},200),e(document).on("click",".wc-shipping-zone-method-settings",function(){e(this).closest("tr").find(".wc-shipping-zone-method-type").text()===a._params.method_title&&(e("."+a._serviceToggleSel).trigger("change"),a._initGoogleMaps())}),e(document).on("change","#"+a._inputLatSel+", #"+a._inputLngSel,function(){e(".gm-err-content").length||a._initGoogleMaps()}),e(document).on("change","."+a._serviceToggleSel,function(){e(this).is(":checked")?e(this).closest("table").find("tr:not(:first-child)").fadeIn():e(this).closest("table").find("tr:not(:first-child)").fadeOut()})},_initGoogleMaps:function(t){var a=this;e("#"+a._mapWrapperSel).show().siblings(".description").hide();try{if("undefined"==typeof google||void 0===google.maps)throw"google is not defined";a._buildGoogleMaps()}catch(t){e.getScript("https://maps.googleapis.com/maps/api/js?key="+a._decode(e("#map-secret-key").val())+"&libraries=geometry,places&&language="+a._params.language,function(){a._buildGoogleMaps()})}},_buildGoogleMaps:function(){var t=this,a=-6.175392,o=106.827153,n=e("#"+t._inputLatSel).val(),r=e("#"+t._inputLngSel).val(),i={lat:n=n.length?parseFloat(n):a,lng:r=r.length?parseFloat(r):o},s=wp.template(t._mapCanvasSel),g=wp.template(t._mapSearchSel);e("#"+t._mapCanvasSel).length||e("#"+t._mapWrapperSel).append(s({map_canvas_id:t._mapCanvasSel}));var d=[],c=new google.maps.Map(document.getElementById(t._mapCanvasSel),{center:i,zoom:t._zoomLevel,mapTypeId:"roadmap"}),l=new google.maps.Marker({map:c,position:i,draggable:!0,icon:t._params.marker}),p=new google.maps.InfoWindow({maxWidth:350});n==a&&r==o?(p.setContent(t._params.txt.drag_marker),p.open(c,l)):t._setLatLng(l.position,l,c,p),google.maps.event.addListener(l,"dragstart",function(e){p.close()}),google.maps.event.addListener(l,"dragend",function(e){t._setLatLng(e.latLng,l,c,p)}),d.push(l),e("#"+t._mapSearchSel).length||e("#"+t._mapWrapperSel).append(g({map_search_id:t._mapSearchSel}));var m=document.getElementById(t._mapSearchSel),h=new google.maps.places.SearchBox(m);c.controls[google.maps.ControlPosition.TOP_LEFT].push(m),c.addListener("bounds_changed",function(){h.setBounds(c.getBounds())}),h.addListener("places_changed",function(){var e=h.getPlaces();if(0!==e.length){d.forEach(function(e){e.setMap(null)}),d=[];var a=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?(l=new google.maps.Marker({map:c,position:e.geometry.location,draggable:!0,icon:t._params.marker}),t._setLatLng(e.geometry.location,l,c,p),google.maps.event.addListener(l,"dragstart",function(e){p.close()}),google.maps.event.addListener(l,"dragend",function(e){t._setLatLng(e.latLng,l,c,p)}),d.push(l),e.geometry.viewport?a.union(e.geometry.viewport):a.extend(e.geometry.location)):console.log("Returned place contains no geometry")}),c.fitBounds(a)}}),setInterval(function(){e(".gm-err-content").length&&(e("#"+t._mapWrapperSel).hide().siblings(".description").show(),e("#"+t._mapSearchSel).remove(),google=void 0)},1e3)},_setLatLng:function(t,a,o,n){(new google.maps.Geocoder).geocode({latLng:t},function(e,t){t==google.maps.GeocoderStatus.OK&&e[0]&&(n.setContent(e[0].formatted_address),n.open(o,a),a.addListener("click",function(){n.open(o,a)}))}),o.setCenter(t),e("#"+this._inputLatSel).val(t.lat()),e("#"+this._inputLngSel).val(t.lng())},_encode:function(e){var t,a,o,n,r,i,s,g="",d=0;for(e=this._utf8_encode(e);d<e.length;)n=(t=e.charCodeAt(d++))>>2,r=(3&t)<<4|(a=e.charCodeAt(d++))>>4,i=(15&a)<<2|(o=e.charCodeAt(d++))>>6,s=63&o,isNaN(a)?i=s=64:isNaN(o)&&(s=64),g=g+this._keyStr.charAt(n)+this._keyStr.charAt(r)+this._keyStr.charAt(i)+this._keyStr.charAt(s);return g},_decode:function(e){var t,a,o,n,r,i,s="",g=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");g<e.length;)t=this._keyStr.indexOf(e.charAt(g++))<<2|(n=this._keyStr.indexOf(e.charAt(g++)))>>4,a=(15&n)<<4|(r=this._keyStr.indexOf(e.charAt(g++)))>>2,o=(3&r)<<6|(i=this._keyStr.indexOf(e.charAt(g++))),s+=String.fromCharCode(t),64!=r&&(s+=String.fromCharCode(a)),64!=i&&(s+=String.fromCharCode(o));return s=this._utf8_decode(s)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",a=0;a<e.length;a++){var o=e.charCodeAt(a);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t},_utf8_decode:function(e){for(var t="",a=0,o=0,n=0;a<e.length;)(o=e.charCodeAt(a))<128?(t+=String.fromCharCode(o),a++):o>191&&o<224?(n=e.charCodeAt(a+1),t+=String.fromCharCode((31&o)<<6|63&n),a+=2):(n=e.charCodeAt(a+1),c3=e.charCodeAt(a+2),t+=String.fromCharCode((15&o)<<12|(63&n)<<6|63&c3),a+=3);return t}};e(document).ready(function(){t.init(woogosend_params)})}(jQuery);