!function(e){"use strict";var o={inputLatId:"woocommerce_woogosend_origin_lat",inputLngId:"woocommerce_woogosend_origin_lng",mapWrapperId:"woogosend-map-wrapper",mapSearchId:"woogosend-map-search",mapCanvasId:"woogosend-map-canvas",zoomLevel:16,init:function(){var o=this;woogosend_params.show_settings&&setTimeout(function(){for(var o=!1,n=e(document).find(".wc-shipping-zone-method-type"),t=0;t<n.length;t++){var a=n[t];if(e(a).text()==woogosend_params.method_title)return e(a).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(o=!0)}o||(e(".wc-shipping-zone-add-method").trigger("click"),e("select[name='add_method_id']").val(woogosend_params.method_id).trigger("change"))},200),e(document).on("click",".wc-shipping-zone-method-settings",function(){e(this).closest("tr").find(".wc-shipping-zone-method-type").text()===woogosend_params.method_title&&o._initGoogleMaps()})},_initGoogleMaps:function(o){var n=this;try{if("undefined"==typeof google||void 0===google.maps)throw"google is not defined";n._buildGoogleMaps()}catch(o){e.getScript("https://maps.googleapis.com/maps/api/js?key=&libraries=geometry,places",function(){n._buildGoogleMaps()})}},_buildGoogleMaps:function(){var o=this,n=e("#"+o.inputLatId).val(),t=e("#"+o.inputLngId).val(),a={lat:n=n.length?parseFloat(n):-6.175392,lng:t=t.length?parseFloat(t):106.827153},s=wp.template(o.mapCanvasId),g=wp.template(o.mapSearchId);e("#"+o.mapCanvasId).length||e("#"+o.mapWrapperId).append(s({map_canvas_id:o.mapCanvasId}));var i=[],d=new google.maps.Map(document.getElementById(o.mapCanvasId),{center:a,zoom:o.zoomLevel,mapTypeId:"roadmap"}),p=new google.maps.Marker({map:d,position:a,draggable:!0,icon:woogosend_params.marker}),r=new google.maps.InfoWindow({maxWidth:350,content:woogosend_params.txt.drag_marker});r.open(d,p),google.maps.event.addListener(p,"dragstart",function(e){r.close()}),google.maps.event.addListener(p,"dragend",function(e){o._setLatLng(e.latLng,p,d,r)}),i.push(p),e("#"+o.mapSearchId).length||e("#"+o.mapWrapperId).append(g({map_search_id:o.mapSearchId}));var m=document.getElementById(o.mapSearchId),l=new google.maps.places.SearchBox(m);d.controls[google.maps.ControlPosition.TOP_LEFT].push(m),d.addListener("bounds_changed",function(){l.setBounds(d.getBounds())}),l.addListener("places_changed",function(){var e=l.getPlaces();if(0!=e.length){i.forEach(function(e){e.setMap(null)}),i=[];var n=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?(p=new google.maps.Marker({map:d,position:e.geometry.location,draggable:!0,icon:woogosend_params.marker}),o._setLatLng(e.geometry.location,p,d,r),google.maps.event.addListener(p,"dragstart",function(e){r.close()}),google.maps.event.addListener(p,"dragend",function(e){o._setLatLng(e.latLng,p,d,r)}),i.push(p),e.geometry.viewport?n.union(e.geometry.viewport):n.extend(e.geometry.location)):console.log("Returned place contains no geometry")}),d.setZoom(o.zoomLevel),d.fitBounds(n)}})},_setLatLng:function(o,n,t,a){var s=this;(new google.maps.Geocoder).geocode({latLng:o},function(g,i){i==google.maps.GeocoderStatus.OK&&(g[0]?(a.setContent(g[0].formatted_address),a.open(t,n),e("#"+s.inputLatId).val(o.lat()),e("#"+s.inputLngId).val(o.lng())):(e("#"+s.inputLatId).val(""),e("#"+s.inputLngId).val("")))}),t.setCenter(o)}};e(document).ready(function(){o.init()})}(jQuery);